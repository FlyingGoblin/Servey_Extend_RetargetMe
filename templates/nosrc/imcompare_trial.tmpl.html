<patTemplate:tmpl name="imcompare_trial">

<script type="text/javascript" src="js/tinybox.js"></script>
<link rel="stylesheet" type="text/css" href="css/tinybox.css" />

<script type="text/javascript">
<!--

// following are some javascripts automatically generated by Adobe Dreamweaver in order
// to handle the change of display on mouse-over events

function MM_preloadImages() { //v3.0
  	var d=document; 
  	if(d.images) { 
  	  	if (!d.MM_p) 
  	  	  	d.MM_p=new Array();
    	var i,j=d.MM_p.length
    	var a=MM_preloadImages.arguments; 
    	for (i=0; i<a.length; i++)
    		if (a[i].indexOf("#")!=0) { 
    			d.MM_p[j]=new Image; d.MM_p[j++].src=a[i];
    		}
    }
}

function MM_swapImgRestore() { //v3.0
  	var i,x,a=document.MM_sr; 
  	for(i=0;a&&i<a.length&&(x=a[i])&&x.oSrc;i++) {
  		x.src=x.oSrc;
	}
}
function MM_findObj(n, d) { //v4.01
	var p,i,x;
	if (!d) 
		d=document; 
	if((p=n.indexOf("?"))>0&&parent.frames.length) {
    	d=parent.frames[n.substring(p+1)].document; 
    	n=n.substring(0,p);
    }
  	if(!(x=d[n])&&d.all) 
  	  	x=d.all[n]; 
	for (i=0;!x&&i<d.forms.length;i++) 
		x=d.forms[i][n];
  	for(i=0;!x&&d.layers&&i<d.layers.length;i++) 
  	  	x=MM_findObj(n,d.layers[i].document);
  	if(!x && d.getElementById) 
  	  	x=d.getElementById(n); 
	return x;
}

function MM_swapImage() { //v3.0
 	var i,j=0,x,a=MM_swapImage.arguments; 
  	document.MM_sr=new Array; 
  	for(i=0;i<(a.length-2);i+=3)
  		if ((x=MM_findObj(a[i]))!=null) {
  	  		document.MM_sr[j++]=x; 
  	  		if(!x.oSrc) 
  	  	  		x.oSrc=x.src; 
	  	  	x.src=a[i+2];
	 	}
}

// Functions to handle result selection

function markImage(obj) {
	var selected_id = $(obj).attr('id');
	
	if (selected_id == 'res1') {
		unselected_id = 'res2';
		selected_side = 'left';
		unselected_side = 'right';
		$('#selected_id').val($('#res1_id').val());
	} else {
		unselected_id = 'res1';	
		selected_side = 'right';
		unselected_side = 'left';	
		$('#selected_id').val($('#res2_id').val());			
	}
	// turn this on
	$(obj).css('border', '5px solid red');		
	// turn the other off
	$('#' + unselected_id).css('border', '5px solid black');

	$('#next_button').removeAttr('disabled'); // enable the button
}

function next_onClick() {
	var selected_id = $('#selected_id').val();
	var expected_id = $('#expected_id').val();
	if (selected_id!=expected_id) {
		var msg = "<h2>Hmm...</h2><br>"+
		"Are you sure you picked the right result?<br>"+
		"Click anywhere outside this window and try again.<br>"+
		"(If you are utterly convinced that this is your preferred one, just choose<br>"+ 
		"the other one and continue. Your results are not being stored yet)";
		TINY.box.show(msg,0,0,0,0,null,null);
	} else {
		var trialno = $('#trialno').val();
		if (trialno==0) {
			var msg = "<h2>Great!</h2><br>"+
				"This seems to be a reasonable choice in this case.<br>" +
				"Let's do one more. Click anywhere outside this window to continue.";
			TINY.box.show(msg,0,0,0,0,null,submit);
		} else {
			var msg = "<h2>Great!</h2><br>"+
			"You got the hang of it.<br>"+
			"From now on it's the real deal.<br>"+
			"Click anywhere outside this window to continue, and have fun!";
			TINY.box.show(msg,0,0,0,0,null,submit);
		}
	}
}

function submit() {
	document.compareForm.submit();
}

$(document).ready(function(){
  MM_preloadImages('data/{DATASET_ID}/{RES1_ID}.jpg','data/{DATASET_ID}/{RES2_ID}.jpg');
});

//start timer after the entire page has loaded
window.onload = function() {
	var trialno = $('#trialno').val();
	if (trialno==0) {
		var msg = "<h2>Welcome!</h2><br>"+
		"This is the main page you will use to compare between different retargeting results.<br>"+
		"Let's try it a couple of times before we begin.<br>"+
		"Click anywhere outside this message box, and follow the instructions on the page.<br>";
		TINY.box.show(msg,0,0,0,0,null,null);
	}
};

//-->
</script>

<div id="page">
<table width="1024px" border="0" align="center">
  <tr>
    <td><div align="left">
    Hover the mouse over a thumbnail image to switch the display to the corresponding result.<br>
    Click on the image you like better (or the one you dislike least), and click 'Next' to submit and continue.
    </div></td>
  </tr>
  <tr>
    <td><hr /></td>
  </tr>
  <tr>
    <td><div align="center">
      <table border="0px" align="center" >
        <tr>
          <td><div align="center"><img src="data/{DATASET_ID}/{RES1_ID}_thumb.jpg" id="res1" name="res1" class="thumb" style="border: 5px solid black" onmouseover="MM_swapImage('display','','data/{DATASET_ID}/{RES1_ID}.jpg',1)" onclick="markImage(this)"/></div></td>
          <td><div align="center"><img src="data/{DATASET_ID}/{RES2_ID}_thumb.jpg" id="res2" name="res2" class="thumb" style="border: 5px solid black" onmouseover="MM_swapImage('display','','data/{DATASET_ID}/{RES2_ID}.jpg',1)" onclick="markImage(this)"/></div></td>
        </tr>
        <tr>
          <td><div align="center">1</div></td>
          <td><div align="center">2</div></td>
        </tr>
      </table>
    </div></td>
  </tr>
  <tr>
    <td>
      <table border="0px" align="center" cellspacing="10px">
          <tr>
<!--            <td><img src="data/{DATASET_ID}/src.jpg"/></td>-->
            <td><img src="data/{DATASET_ID}/{RES1_ID}.jpg" name="display" id="display"/></td>
          </tr>
          <tr>
<!--            <td><div align="center">Source</div></td>-->
            <td><div align="center">Retarget</div></td>
          </tr>
      </table>
    </td>
  </tr>
  <tr>
	<td align="center">
		<br>
	    <form name="compareForm" action="index.php" method="post">
			<span id="basicForm">  	
			  <input type="button" id="next_button" value="Next &gt;&gt;" onclick="next_onClick()" style="width:100px;" disabled="disabled"/>
			  <input type="hidden" id="selected_id" name="selected_id" value="" />
			  <input type="hidden" id="dataset_id" name="dataset_id" value="{DATASET_ID}" />
			  <input type="hidden" id="res1_id" name="res1_id" value="{RES1_ID}" />
			  <input type="hidden" id="res2_id" name="res2_id" value="{RES2_ID}" />	  	  
			  <input type="hidden" id="expected_id" name="expected_id" value="{EXPECTED_ID}" />
			  <input type="hidden" id="pageid" name="pageid" value="{PAGEID}"/>
			  <input type="hidden" id="trialno" name="trialno" value="{TRIALNO}"/>
		      <input type="hidden" id="formname" name="formname" value="{FORM_NAME}" />
			</span>
		</form>
	</td>
  </tr>
</table>
</div>

</patTemplate:tmpl>
